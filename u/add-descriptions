#!/usr/bin/env raku

use Grammar::Tracer;
use Data::Dump::Tree;
use Config::TOML;

my %descriptions = %(
    "caffe2-aten"                         => "xxx",
    "caffe2-blob"                         => "xxx",
    "caffe2-c10"                          => "xxx",
    "caffe2-cfg"                          => "xxx",
    "caffe2-common"                       => "xxx",
    "caffe2-context"                      => "xxx",
    "caffe2-db"                           => "xxx",
    "caffe2-derive"                       => "xxx",
    "caffe2-env"                          => "xxx",
    "caffe2-event"                        => "xxx",
    "caffe2-export"                       => "xxx",
    "caffe2-graph"                        => "xxx",
    "caffe2-histogram"                    => "xxx",
    "caffe2-ideep"                        => "xxx",
    "caffe2-image"                        => "xxx",
    "caffe2-imports"                      => "xxx",
    "caffe2-init"                         => "xxx",
    "caffe2-math"                         => "xxx",
    "caffe2-mem"                          => "xxx",
    "caffe2-miopen"                       => "xxx",
    "caffe2-module"                       => "xxx",
    "caffe2-nomnigraph"                   => "xxx",
    "caffe2-operator"                     => "xxx",
    "caffe2-opt"                          => "xxx",
    "caffe2-output"                       => "xxx",
    "caffe2-perfkernels"                  => "xxx",
    "caffe2-plan"                         => "xxx",
    "caffe2-predictor"                    => "xxx",
    "caffe2-prof"                         => "xxx",
    "caffe2-proto"                        => "xxx",
    "caffe2-qtensor"                      => "xxx",
    "caffe2-quant"                        => "xxx",
    "caffe2-queue"                        => "xxx",
    "caffe2-random"                       => "xxx",
    "caffe2-register"                     => "xxx",
    "caffe2-registry"                     => "xxx",
    "caffe2-serde"                        => "xxx",
    "caffe2-serverquantize"               => "xxx",
    "caffe2-sgd"                          => "xxx",
    "caffe2-stats"                        => "xxx",
    "caffe2-store"                        => "xxx",
    "caffe2-system"                       => "xxx",
    "caffe2-tensor"                       => "xxx",
    "caffe2-test"                         => "xxx",
    "caffe2-threadpool"                   => "xxx",
    "caffe2-timer"                        => "xxx",
    "caffe2-trace"                        => "xxx",
    "caffe2-traits"                       => "xxx",
    "caffe2-transform"                    => "xxx",
    "caffe2-txform"                       => "xxx",
    "caffe2-types"                        => "xxx",
    "caffe2-util"                         => "xxx",
    "caffe2-version"                      => "xxx",
    "caffe2-video"                        => "xxx",
    "caffe2op-abs"                        => "xxx",
    "caffe2op-accum"                      => "xxx",
    "caffe2op-accuracy"                   => "xxx",
    "caffe2op-acos"                       => "xxx",
    "caffe2op-activation"                 => "xxx",
    "caffe2op-affine"                     => "xxx",
    "caffe2op-alias"                      => "xxx",
    "caffe2op-apmeter"                    => "xxx",
    "caffe2op-args"                       => "xxx",
    "caffe2op-asin"                       => "xxx",
    "caffe2op-assert"                     => "xxx",
    "caffe2op-asyncnet"                   => "xxx",
    "caffe2op-atan"                       => "xxx",
    "caffe2op-atomics"                    => "xxx",
    "caffe2op-batch"                      => "xxx",
    "caffe2op-bbox"                       => "xxx",
    "caffe2op-bisect"                     => "xxx",
    "caffe2op-bucketize"                  => "xxx",
    "caffe2op-cast"                       => "xxx",
    "caffe2op-cbrt"                       => "xxx",
    "caffe2op-ceil"                       => "xxx",
    "caffe2op-channelbackprop"            => "xxx",
    "caffe2op-channelshuffle"             => "xxx",
    "caffe2op-channelstats"               => "xxx",
    "caffe2op-clip"                       => "xxx",
    "caffe2op-collect"                    => "xxx",
    "caffe2op-communicator"               => "xxx",
    "caffe2op-concatsplit"                => "xxx",
    "caffe2op-conditional"                => "xxx",
    "caffe2op-conv"                       => "xxx",
    "caffe2op-copy"                       => "xxx",
    "caffe2op-cos"                        => "xxx",
    "caffe2op-cosh"                       => "xxx",
    "caffe2op-counter"                    => "xxx",
    "caffe2op-couple"                     => "xxx",
    "caffe2op-crash"                      => "xxx",
    "caffe2op-crfviterbi"                 => "xxx",
    "caffe2op-crossentropy"               => "xxx",
    "caffe2op-ctc"                        => "xxx",
    "caffe2op-cube"                       => "xxx",
    "caffe2op-dataset"                    => "xxx",
    "caffe2op-deform"                     => "xxx",
    "caffe2op-densevec"                   => "xxx",
    "caffe2op-dequant"                    => "xxx",
    "caffe2op-distance"                   => "xxx",
    "caffe2op-do"                         => "xxx",
    "caffe2op-dropout"                    => "xxx",
    "caffe2op-elementwise"                => "xxx",
    "caffe2op-elu"                        => "xxx",
    "caffe2op-enforce"                    => "xxx",
    "caffe2op-erf"                        => "xxx",
    "caffe2op-exp"                        => "xxx",
    "caffe2op-expand"                     => "xxx",
    "caffe2op-fallbackgpu"                => "xxx",
    "caffe2op-featuremaps"                => "xxx",
    "caffe2op-feed"                       => "xxx",
    "caffe2op-filler"                     => "xxx",
    "caffe2op-find"                       => "xxx",
    "caffe2op-flatten"                    => "xxx",
    "caffe2op-floor"                      => "xxx",
    "caffe2op-free"                       => "xxx",
    "caffe2op-fullyconnected"             => "xxx",
    "caffe2op-fusedrowwise"               => "xxx",
    "caffe2op-gather"                     => "xxx",
    "caffe2op-gelu"                       => "xxx",
    "caffe2op-generateproposals"          => "xxx",
    "caffe2op-glu"                        => "xxx",
    "caffe2op-groupnorm"                  => "xxx",
    "caffe2op-gru"                        => "xxx",
    "caffe2op-halffloat"                  => "xxx",
    "caffe2op-hardsigmoid"                => "xxx",
    "caffe2op-heatmap"                    => "xxx",
    "caffe2op-histogram"                  => "xxx",
    "caffe2op-hsoftmax"                   => "xxx",
    "caffe2op-i8quantized"                => "xxx",
    "caffe2op-if"                         => "xxx",
    "caffe2op-im2col"                     => "xxx",
    "caffe2op-index"                      => "xxx",
    "caffe2op-indexhash"                  => "xxx",
    "caffe2op-inference"                  => "xxx",
    "caffe2op-instancenorm"               => "xxx",
    "caffe2op-integralimage"              => "xxx",
    "caffe2op-isempty"                    => "xxx",
    "caffe2op-jsd"                        => "xxx",
    "caffe2op-keysplit"                   => "xxx",
    "caffe2op-lastnwindow"                => "xxx",
    "caffe2op-layernorm"                  => "xxx",
    "caffe2op-leakyrelu"                  => "xxx",
    "caffe2op-lengthspad"                 => "xxx",
    "caffe2op-lengthsplit"                => "xxx",
    "caffe2op-lengthsreduce"              => "xxx",
    "caffe2op-lengthstile"                => "xxx",
    "caffe2op-lengthstop"                 => "xxx",
    "caffe2op-listwisel2r"                => "xxx",
    "caffe2op-loadsave"                   => "xxx",
    "caffe2op-locallyconnected"           => "xxx",
    "caffe2op-localresponsenormalization" => "xxx",
    "caffe2op-log"                        => "xxx",
    "caffe2op-logit"                      => "xxx",
    "caffe2op-loss"                       => "xxx",
    "caffe2op-lpnorm"                     => "xxx",
    "caffe2op-lppool"                     => "xxx",
    "caffe2op-lstm"                       => "xxx",
    "caffe2op-map"                        => "xxx",
    "caffe2op-marginrank"                 => "xxx",
    "caffe2op-mask"                       => "xxx",
    "caffe2op-matmul"                     => "xxx",
    "caffe2op-maxpool"                    => "xxx",
    "caffe2op-mean"                       => "xxx",
    "caffe2op-mergeid"                    => "xxx",
    "caffe2op-minmax"                     => "xxx",
    "caffe2op-mish"                       => "xxx",
    "caffe2op-mod"                        => "xxx",
    "caffe2op-moments"                    => "xxx",
    "caffe2op-multiclass"                 => "xxx",
    "caffe2op-nanreplace"                 => "xxx",
    "caffe2op-negative"                   => "xxx",
    "caffe2op-negativegradient"           => "xxx",
    "caffe2op-ngram"                      => "xxx",
    "caffe2op-nmsbox"                     => "xxx",
    "caffe2op-normalize"                  => "xxx",
    "caffe2op-numpytile"                  => "xxx",
    "caffe2op-onehot"                     => "xxx",
    "caffe2op-onnxwhile"                  => "xxx",
    "caffe2op-orderswitch"                => "xxx",
    "caffe2op-packrnnseq"                 => "xxx",
    "caffe2op-packsegments"               => "xxx",
    "caffe2op-pad"                        => "xxx",
    "caffe2op-partition"                  => "xxx",
    "caffe2op-percentile"                 => "xxx",
    "caffe2op-perplexity"                 => "xxx",
    "caffe2op-plt"                        => "xxx",
    "caffe2op-pool"                       => "xxx",
    "caffe2op-pow"                        => "xxx",
    "caffe2op-prefetch"                   => "xxx",
    "caffe2op-prelu"                      => "xxx",
    "caffe2op-prepend"                    => "xxx",
    "caffe2op-quantdecode"                => "xxx",
    "caffe2op-quantile"                   => "xxx",
    "caffe2op-rankloss"                   => "xxx",
    "caffe2op-reciprocal"                 => "xxx",
    "caffe2op-reduce"                     => "xxx",
    "caffe2op-relu"                       => "xxx",
    "caffe2op-remove"                     => "xxx",
    "caffe2op-reservoir"                  => "xxx",
    "caffe2op-reshape"                    => "xxx",
    "caffe2op-resize"                     => "xxx",
    "caffe2op-reversepacked"              => "xxx",
    "caffe2op-rmac"                       => "xxx",
    "caffe2op-rms"                        => "xxx",
    "caffe2op-rnn"                        => "xxx",
    "caffe2op-roialign"                   => "xxx",
    "caffe2op-roipool"                    => "xxx",
    "caffe2op-rowmul"                     => "xxx",
    "caffe2op-rsqrt"                      => "xxx",
    "caffe2op-scale"                      => "xxx",
    "caffe2op-scope"                      => "xxx",
    "caffe2op-segmentreduction"           => "xxx",
    "caffe2op-selfbinning"                => "xxx",
    "caffe2op-selu"                       => "xxx",
    "caffe2op-sequence"                   => "xxx",
    "caffe2op-shape"                      => "xxx",
    "caffe2op-sigmoid"                    => "xxx",
    "caffe2op-sin"                        => "xxx",
    "caffe2op-sinh"                       => "xxx",
    "caffe2op-sinusoid"                   => "xxx",
    "caffe2op-slice"                      => "xxx",
    "caffe2op-softmax"                    => "xxx",
    "caffe2op-softplus"                   => "xxx",
    "caffe2op-softsign"                   => "xxx",
    "caffe2op-spacebatch"                 => "xxx",
    "caffe2op-sparsedropout"              => "xxx",
    "caffe2op-sparselpreg"                => "xxx",
    "caffe2op-sparsenormalize"            => "xxx",
    "caffe2op-sparsetodense"              => "xxx",
    "caffe2op-spatialbatchnorm"           => "xxx",
    "caffe2op-spatialsoftmax"             => "xxx",
    "caffe2op-sqr"                        => "xxx",
    "caffe2op-sqrt"                       => "xxx",
    "caffe2op-stats"                      => "xxx",
    "caffe2op-stopgradient"               => "xxx",
    "caffe2op-string"                     => "xxx",
    "caffe2op-stump"                      => "xxx",
    "caffe2op-stylizer"                   => "xxx",
    "caffe2op-summarize"                  => "xxx",
    "caffe2op-swish"                      => "xxx",
    "caffe2op-tan"                        => "xxx",
    "caffe2op-tanh"                       => "xxx",
    "caffe2op-tensorprotos"               => "xxx",
    "caffe2op-textfile"                   => "xxx",
    "caffe2op-thresholdedrelu"            => "xxx",
    "caffe2op-tile"                       => "xxx",
    "caffe2op-topk"                       => "xxx",
    "caffe2op-transpose"                  => "xxx",
    "caffe2op-tt"                         => "xxx",
    "caffe2op-unique"                     => "xxx",
    "caffe2op-unsafecoalesce"             => "xxx",
    "caffe2op-upsample"                   => "xxx",
    "caffe2op-utility"                    => "xxx",
    "caffe2op-variablepad"                => "xxx",
    "caffe2op-weightedmultisample"        => "xxx",
    "caffe2op-weightedsample"             => "xxx",
    "caffe2op-while"                      => "xxx",
    "caffe2op-workspace"                  => "xxx",
    "caffe2op-zerog"                      => "xxx",
);

sub ensure-correct-toml($file, $readme) {

    say "ensuring correct data inside $file";

    my %toml = from-toml($file.IO.slurp);

    my $name = %toml<package><name>;

    if $readme.IO.e {

        %toml<package><readme> = "README.md";

    } else {

        %toml<package><readme> = "../README.md";
    }

    %toml<package><description>   = %descriptions{$name};
    %toml<package><repository>    = "https://github.com/kleb6/caffe2-rs";
    %toml<package><documentation> = "https://docs.rs/$name";

    $file.IO.spurt: to-toml(%toml);
}

for %descriptions.keys.sort -> $crate {

    my $toml = $crate ~ "/Cargo.toml";

    ensure-correct-toml($toml,$readme);
}
